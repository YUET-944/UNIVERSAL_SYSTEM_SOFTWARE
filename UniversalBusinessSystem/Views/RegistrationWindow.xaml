<Window x:Class="UniversalBusinessSystem.Views.RegistrationWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        Title="Universal Business System - Registration" 
        Height="700" Width="500"
        WindowStartupLocation="CenterScreen"
        ResizeMode="NoResize"
        Background="{DynamicResource MaterialDesignPaper}"
        ScrollViewer.VerticalScrollBarVisibility="Auto">
    
    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Margin="0,0,0,20">
            <materialDesign:PackIcon Kind="Store" 
                                   Width="48" Height="48" 
                                   HorizontalAlignment="Center"
                                   Foreground="{DynamicResource PrimaryHueMidBrush}"/>
            <TextBlock Text="Create Your Business Account" 
                      FontSize="20" FontWeight="SemiBold"
                      HorizontalAlignment="Center"
                      Margin="0,10,0,5"/>
            <TextBlock Text="Get started with Universal Business System" 
                      FontSize="12" Opacity="0.7"
                      HorizontalAlignment="Center"/>
        </StackPanel>

        <!-- Registration Form -->
        <ScrollViewer Grid.Row="1">
            <StackPanel>
                <!-- Personal Information -->
                <Expander Header="Personal Information" IsExpanded="True" Margin="0,0,0,10">
                    <StackPanel Margin="0,10,0,0">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="10"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBox Grid.Column="0" 
                                   materialDesign:HintAssist.Hint="First Name"
                                   materialDesign:HintAssist.IsFloating="True"
                                   Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                   Text="{Binding FirstName}"/>
                            <TextBox Grid.Column="2" 
                                   materialDesign:HintAssist.Hint="Last Name"
                                   materialDesign:HintAssist.IsFloating="True"
                                   Style="{StaticResource MaterialDesignOutlinedTextBox}"
                                   Text="{Binding LastName}"/>
                        </Grid>
                        <TextBox Margin="0,10,0,0"
                               materialDesign:HintAssist.Hint="Username"
                               materialDesign:HintAssist.IsFloating="True"
                               Style="{StaticResource MaterialDesignOutlinedTextBox}"
                               Text="{Binding Username}"/>
                        <TextBox Margin="0,10,0,0"
                               materialDesign:HintAssist.Hint="Email Address"
                               materialDesign:HintAssist.IsFloating="True"
                               Style="{StaticResource MaterialDesignOutlinedTextBox}"
                               Text="{Binding Email}"/>
                        <TextBox Margin="0,10,0,0"
                               materialDesign:HintAssist.Hint="Phone Number"
                               materialDesign:HintAssist.IsFloating="True"
                               Style="{StaticResource MaterialDesignOutlinedTextBox}"
                               Text="{Binding Phone}"/>
                    </StackPanel>
                </Expander>

                <!-- Organization Information -->
                <Expander Header="Organization Information" IsExpanded="True" Margin="0,0,0,10">
                    <StackPanel Margin="0,10,0,0">
                        <TextBox materialDesign:HintAssist.Hint="Business Name"
                               materialDesign:HintAssist.IsFloating="True"
                               Style="{StaticResource MaterialDesignOutlinedTextBox}"
                               Text="{Binding OrganizationName}"/>
                        <TextBox Margin="0,10,0,0"
                               materialDesign:HintAssist.Hint="Business Description"
                               materialDesign:HintAssist.IsFloating="True"
                               Style="{StaticResource MaterialDesignOutlinedTextBox}"
                               Text="{Binding OrganizationDescription}"/>
                        <TextBox Margin="0,10,0,0"
                               materialDesign:HintAssist.Hint="Business Address"
                               materialDesign:HintAssist.IsFloating="True"
                               Style="{StaticResource MaterialDesignOutlinedTextBox}"
                               Text="{Binding OrganizationAddress}"/>
                    </StackPanel>
                </Expander>

                <!-- Shop Type Selection -->
                <Expander Header="Business Type" IsExpanded="True" Margin="0,0,0,10">
                    <StackPanel Margin="0,10,0,0">
                        <ComboBox materialDesign:HintAssist.Hint="Select your business type"
                                materialDesign:HintAssist.IsFloating="True"
                                Style="{StaticResource MaterialDesignOutlinedComboBox}"
                                ItemsSource="{Binding ShopTypes}"
                                SelectedItem="{Binding SelectedShopType}"
                                DisplayMemberPath="Name"/>
                    </StackPanel>
                </Expander>

                <!-- Password -->
                <Expander Header="Security" IsExpanded="True" Margin="0,0,0,10">
                    <StackPanel Margin="0,10,0,0">
                        <PasswordBox x:Name="PasswordBox"
                                   materialDesign:HintAssist.Hint="Password"
                                   materialDesign:HintAssist.IsFloating="True"
                                   Style="{StaticResource MaterialDesignOutlinedPasswordBox}"
                                   PasswordChanged="PasswordBox_PasswordChanged"/>
                        <PasswordBox Margin="0,10,0,0"
                                   x:Name="ConfirmPasswordBox"
                                   materialDesign:HintAssist.Hint="Confirm Password"
                                   materialDesign:HintAssist.IsFloating="True"
                                   Style="{StaticResource MaterialDesignOutlinedPasswordBox}"
                                   PasswordChanged="ConfirmPasswordBox_PasswordChanged"/>
                    </StackPanel>
                </Expander>

                <!-- Error Message -->
                <TextBlock Text="{Binding ErrorMessage}"
                         Foreground="Red"
                         TextWrapping="Wrap"
                         Visibility="{Binding HasError, Converter={StaticResource BooleanToVisibilityConverter}}"
                         Margin="0,10"/>

                <!-- Register Button -->
                <Button x:Name="CreateAccountButton"
                       Content="Create Account"
                       Style="{StaticResource MaterialDesignRaisedButton}"
                       Command="{Binding RegisterCommand}"
                       Click="CreateAccountButton_Click"
                       IsDefault="True"
                       Margin="0,20,0,0"/>

                <Button Content="Test Button"
                       Style="{StaticResource MaterialDesignFlatButton}"
                       Margin="0,10,0,0"
                       Click="TestButton_Click"/>

                <Button Content="Diagnose Registration"
                       Style="{StaticResource MaterialDesignFlatButton}"
                       Margin="0,5,0,0"
                       Click="DiagnoseRegistration_Click"/>
            </StackPanel>
        </ScrollViewer>

        <!-- Footer -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,20,0,0">
            <Button Content="Back to Login" 
                   Style="{StaticResource MaterialDesignFlatButton}"
                   Command="{Binding NavigateToLoginCommand}"/>
        </StackPanel>

        <!-- Loading Overlay -->
        <Grid Grid.RowSpan="3" 
             Background="#80000000" 
             Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <ProgressBar IsIndeterminate="True" 
                           Style="{StaticResource MaterialDesignCircularProgressBar}"
                           Width="64" Height="64"
                           Margin="0,0,0,20"/>
                <TextBlock Text="Creating account..." 
                          Foreground="White"
                          HorizontalAlignment="Center"/>
            </StackPanel>
        </Grid>
    </Grid>
</Window>
